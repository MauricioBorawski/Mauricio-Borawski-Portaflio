---
import Title from "../components/Title.astro";
import Divider from "../components/Divider.astro";
import Button from "../components/Button.astro";
import ExperienceSection from "../components/ExperienceSection.astro";

import { companies, experiences } from "../constants";
---

<section class="flex flex-col my-12 mx-6 h-screen lg:h-[75vh] lg:w-4/6 justify-center items-start">
  <Title type="h2" class="text-3xl md:text-4xl">Where I've worked</Title>
  <div class="flex flex-col mt-5 items-start justify-start gap-3 md:items-center md:flex-row">
    <div class="flex gap-1 h-full items-center md:flex-col" id="experience-places">
      {
        companies.map((company) => (
          <Button id={`btn-experience`} active={experiences[company].active}>
            {company}
          </Button>
        ))
      }
    </div>
    <Divider class="sm:hidden lg:block" />
    <div class="h-full w-5/6 lg:w-4/6">
      {
        companies.map((company) => (
          <ExperienceSection
            id={"experience-content"}
            active={experiences[company].active}
            achivements={experiences[company].achivements}
            technologies={experiences[company].technologies}
            title={experiences[company].title}
            time={experiences[company].time}
            summary={experiences[company].summary}
            dataSet={company}
          />
        ))
      }
    </div>
  </div>
</section>

<script>
  import { companies, experiences, Companies } from "../constants";

  const activeBtnClasses = ["bg-primaryOrange", "text-slate-50"];

  if (companies && experiences) {

    const buttons = document.querySelectorAll("#btn-experience");
    const experienceContent = document.querySelectorAll(
      "#experience-content"
    ) as unknown as HTMLElement[];

    buttons.forEach((btn) => {
      btn.addEventListener("click", (arg: any) => {
        const company = arg.target.textContent.trim() as Companies;
        const currentBtnState = experiences[company].active;

        if (!currentBtnState) {
          activeBtnClasses.forEach((style) => {
            btn.classList.add(style);

            buttons.forEach((button) => {
              if (
                button.textContent?.trim() &&
                button.textContent?.trim() !== company
              ) {
                button.classList.remove(style);
                experiences[button.textContent?.trim() as Companies].active =
                  currentBtnState;
              }
            });

            experienceContent.forEach((element) => {
              if (element.dataset.company === company) {
                element.classList.remove("hidden");
              } else {
                element.classList.add("hidden");
              }
            });
          });
        }
        experiences[company].active = !currentBtnState;
      });
    });
  }
</script>
